<!-- Label -->
@if (showLabel()) {
  <form-label
    [label]="label()"
    [layout]="layout()"
    [props]="props()"
    [collapsibleEl]="collapsibleEl"
    [customComponent]="customLabelComponent()"
    [customTemplate]="customLabelTemplate()"
    [state]="collapsibleState()"
    [controlLayout]="{
      type: 'label',
      layout: layout(),
    }"
    [ngClass]="{
      required:
        !layout()?.autoAddRequiredClass === true
          ? (control() | isControlRequired)
          : null,
    }"
  ></form-label>
}

<div
  #collapsibleEl
  [controlLayout]="{
    type: 'content',
    layout: layout(),
  }"
>
  <!-- Description (before) -->
  @if (description() && descriptionPosition() !== "after") {
    <ng-container [ngTemplateOutlet]="descriptionTemplate"></ng-container>
  }

  <ng-content></ng-content>

  <!-- Validation message -->
  @if (renderErrorSection()) {
    <error-message
      [control]="control()"
      [validators]="validators()"
      [customComponent]="customErrorComponent()"
      [customTemplate]="customErrorTemplate()"
      [controlLayout]="{
        type: 'error',
        layout: layout(),
      }"
      [ngClass]="{
        hidden: !showErrors(),
      }"
    ></error-message>
  }

  <!-- Description (after) -->
  @if (description() && descriptionPosition() === "after") {
    <ng-container [ngTemplateOutlet]="descriptionTemplate"></ng-container>
  }
</div>

<!-- Description template -->
<ng-template #descriptionTemplate>
  <span
    class="form-description"
    [ngClass]="{
      'position-after': descriptionPosition() === 'after',
    }"
    [controlLayout]="{
      type: 'description',
      layout: layout(),
    }"
    >{{ description() }}</span
  >
</ng-template>
